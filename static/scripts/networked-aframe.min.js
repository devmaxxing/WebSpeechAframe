!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";n(3),n(1),n(20),n(21),n(19)},function(t,e,n){"use strict";var i=n(22),o=n(23),r=n(12),a=n(15),s=n(14),c=n(13),u=n(16),l={};l.app="",l.room="",l.clientId="",l.options=i,l.utils=o,l.log=new r,l.schemas=new a,l.version="0.6.1",l.adapters=new u;var h=new s,d=new c(h);l.connection=d,l.entities=h,t.exports=window.NAF=l},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(11),c=function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),a(e,[{key:"setServerUrl",value:function(t){this.notImplemented("setServerUrl")}},{key:"setApp",value:function(t){this.notImplemented("setApp")}},{key:"setRoom",value:function(t){this.notImplemented("setRoom")}},{key:"setWebRtcOptions",value:function(t){this.notImplemented("setWebRtcOptions")}},{key:"setServerConnectListeners",value:function(t,e){this.notImplemented("setServerConnectListeners")}},{key:"setRoomOccupantListener",value:function(t){this.notImplemented("setRoomOccupantListener")}},{key:"setDataChannelListeners",value:function(t,e,n){this.notImplemented("setDataChannelListeners")}},{key:"connect",value:function(){this.notImplemented("connect")}},{key:"shouldStartConnectionTo",value:function(t){this.notImplemented("shouldStartConnectionTo")}},{key:"startStreamConnection",value:function(t){this.notImplemented("startStreamConnection")}},{key:"closeStreamConnection",value:function(t){this.notImplemented("closeStreamConnection")}},{key:"getConnectStatus",value:function(t){this.notImplemented("getConnectStatus")}},{key:"getMediaStream",value:function(t){return Promise.reject("Interface method not implemented: getMediaStream")}},{key:"getServerTime",value:function(){this.notImplemented("getServerTime")}},{key:"sendData",value:function(t,e,n){this.notImplemented("sendData")}},{key:"sendDataGuaranteed",value:function(t,e,n){this.notImplemented("sendDataGuaranteed")}},{key:"broadcastData",value:function(t,e){this.notImplemented("broadcastData")}},{key:"broadcastDataGuaranteed",value:function(t,e){this.notImplemented("broadcastDataGuaranteed")}},{key:"disconnect",value:function(){this.notImplemented("disconnect")}}]),e}(s);t.exports=c},function(t,e,n){"use strict";if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");var i=THREE.Math.degToRad,o=n(4);AFRAME.registerComponent("lerp",{schema:{properties:{default:["position","rotation","scale"]}},init:function(){var t=this.el;this.lastPosition=t.getAttribute("position"),this.lastRotation=t.getAttribute("rotation"),this.lastScale=t.getAttribute("scale"),this.lerpingPosition=!1,this.lerpingRotation=!1,this.lerpingScale=!1,this.timeOfLastUpdate=0},tick:function(t,e){var n,i=this.now(),o=this.el.object3D;this.checkForComponentChanged(),this.lerpingPosition&&(n=(i-this.startLerpTimePosition)/this.duration,o.position.lerpVectors(this.startPosition,this.targetPosition,n),n>=1&&(this.lerpingPosition=!1)),this.lerpingRotation&&(n=(i-this.startLerpTimeRotation)/this.duration,THREE.Quaternion.slerp(this.startRotation,this.targetRotation,o.quaternion,n),n>=1&&(this.lerpingRotation=!1)),this.lerpingScale&&(n=(i-this.startLerpTimeScale)/this.duration,o.scale.lerpVectors(this.startScale,this.targetScale,n),n>=1&&(this.lerpingScale=!1))},checkForComponentChanged:function(){var t=this.el,e=!1,n=t.getAttribute("position");this.isLerpable("position")&&!this.almostEqualVec3(this.lastPosition,n)&&(this.toPosition(this.lastPosition,n),this.lastPosition=n,e=!0);var i=t.getAttribute("rotation");this.isLerpable("rotation")&&!this.almostEqualVec3(this.lastRotation,i)&&(this.toRotation(this.lastRotation,i),this.lastRotation=i,e=!0);var o=t.getAttribute("scale");this.isLerpable("scale")&&!this.almostEqualVec3(this.lastScale,o)&&(this.toScale(this.lastScale,o),this.lastScale=o,e=!0),e&&this.updateDuration()},isLerpable:function(t){return this.data.properties.indexOf(t)!=-1},updateDuration:function(){var t=this.now();this.duration=t-this.timeOfLastUpdate,this.timeOfLastUpdate=t},toPosition:function(t,e){this.lerpingPosition=!0,this.startLerpTimePosition=this.now(),this.startPosition=new THREE.Vector3(t.x,t.y,t.z),this.targetPosition=new THREE.Vector3(e.x,e.y,e.z)},toRotation:function(t,e){this.lerpingRotation=!0,this.startLerpTimeRotation=this.now(),this.startRotation=new THREE.Quaternion,this.startRotation.setFromEuler(new THREE.Euler(i(t.x),i(t.y),i(t.z),"YXZ")),this.targetRotation=new THREE.Quaternion,this.targetRotation.setFromEuler(new THREE.Euler(i(e.x),i(e.y),i(e.z),"YXZ"))},toScale:function(t,e){this.lerpingScale=!0,this.startLerpTimeScale=this.now(),this.startScale=new THREE.Vector3(t.x,t.y,t.z),this.targetScale=new THREE.Vector3(e.x,e.y,e.z)},almostEqualVec3:function(t,e){return o(t.x,e.x)&&o(t.y,e.y)&&o(t.z,e.z)},now:function(){return Date.now()}})},function(t,e){"use strict";function n(t,e,r,a){var s=i(t-e);return null==r&&(r=n.DBL_EPSILON),null==a&&(a=r),s<=r||(s<=a*o(i(t),i(e))||t===e)}var i=Math.abs,o=Math.min;n.FLT_EPSILON=1.1920929e-7,n.DBL_EPSILON=2.220446049250313e-16,t.exports=n},function(t,e,n){"use strict";function i(t){return null===t||void 0===t}function o(t){return!(!t||"object"!==("undefined"==typeof t?"undefined":a(t))||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0]))}function r(t,e,n){var r,h;if(i(t)||i(e))return!1;if(t.prototype!==e.prototype)return!1;if(u(t))return!!u(e)&&(t=s.call(t),e=s.call(e),l(t,e,n));if(o(t)){if(!o(e))return!1;if(t.length!==e.length)return!1;for(r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}try{var d=c(t),f=c(e)}catch(t){return!1}if(d.length!=f.length)return!1;for(d.sort(),f.sort(),r=d.length-1;r>=0;r--)if(d[r]!=f[r])return!1;for(r=d.length-1;r>=0;r--)if(h=d[r],!l(t[h],e[h],n))return!1;return("undefined"==typeof t?"undefined":a(t))===("undefined"==typeof e?"undefined":a(e))}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=Array.prototype.slice,c=n(7),u=n(6),l=t.exports=function(t,e,n){return n||(n={}),t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!t||!e||"object"!=("undefined"==typeof t?"undefined":a(t))&&"object"!=("undefined"==typeof e?"undefined":a(e))?n.strict?t===e:t==e:r(t,e,n))}},function(t,e){"use strict";function n(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function i(t){return t&&"object"==("undefined"==typeof t?"undefined":o(t))&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();e=t.exports=r?n:i,e.supported=n,e.unsupported=i},function(t,e){"use strict";function n(t){var e=[];for(var n in t)e.push(n);return e}e=t.exports="function"==typeof Object.keys?Object.keys:n,e.shim=n},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){n(this,t),this.dict={}}return i(t,[{key:"addChild",value:function(t,e){this.hasParent(t)||(this.dict[t]=[]),this.dict[t].push(e)}},{key:"getChildren",value:function(t){if(!this.hasParent(t))return[];var e=this.dict[t];return delete this.dict[t],e}},{key:"hasParent",value:function(t){return this.dict.hasOwnProperty(t)}}]),t}();t.exports=o},function(t,e,n){"use strict";var i=n(5);t.exports.gatherComponentsData=function(t,e){var n={};for(var i in e){var o=e[i];if("string"==typeof o)t.components.hasOwnProperty(o)&&(n[o]=AFRAME.utils.clone(t.getAttribute(o)));else{var r=NAF.utils.childSchemaToKey(o),a=o.selector?t.querySelector(o.selector):t;if(a&&a.components.hasOwnProperty(o.component)){var s=a.getAttribute(o.component),c=o.property?s[o.property]:s;n[r]=AFRAME.utils.clone(c)}}}return n},t.exports.findDirtyComponents=function(t,e,n){var o=[];for(var r in e){var a,s,c=e[r],u="string"==typeof c;if(u){var l=t.components.hasOwnProperty(c);if(!l)continue;a=c,s=t.getAttribute(c)}else{var h=c.selector,d=c.component,f=c.property,p=h?t.querySelector(h):t,m=p&&p.components.hasOwnProperty(d);if(!m)continue;a=NAF.utils.childSchemaToKey(c),s=p.getAttribute(d),f&&(s=s[f])}var y=n.hasOwnProperty(a);if(y){var v=n[a];i(v,s)||o.push(c)}else o.push(c)}return o}},function(t,e){"use strict";t.exports.compressSyncData=function(t,e){var n=[];n.push(1),n.push(t.networkId),n.push(t.owner),n.push(t.parent),n.push(t.template);var i=this.compressComponents(t.components,e);return n.push(i),n},t.exports.compressComponents=function(t,e){for(var n={},i=0;i<e.length;i++){var o;o="string"==typeof e[i]?e[i]:NAF.utils.childSchemaToKey(e[i]),t.hasOwnProperty(o)&&(n[i]=t[o])}return n},t.exports.decompressSyncData=function(t,e){var n={};n[0]=0,n.networkId=t[1],n.owner=t[2],n.parent=t[3],n.template=t[4];var i=t[5];return e=this.decompressComponents(i,e),n.components=e,n},t.exports.decompressComponents=function(t,e){var n={};for(var i in t){var o,r=e[i];o="string"==typeof r?r:NAF.utils.childSchemaToKey(r),n[o]=t[i]}return n}},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){n(this,t)}return i(t,[{key:"notImplemented",value:function(t){NAF.log.error("Interface method not implemented:",t)}}]),t}();t.exports=o},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){n(this,t),this.debug=!1}return i(t,[{key:"setDebug",value:function(t){this.debug=t}},{key:"write",value:function(){this.debug&&console.log.apply(this,arguments)}},{key:"warn",value:function(){console.warn.apply(this,arguments)}},{key:"error",value:function(){console.error.apply(this,arguments)}}]),t}();t.exports=o},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o={Update:"u",Remove:"r"},r=function(){function t(e){n(this,t),this.entities=e,this.setupDefaultDataSubscriptions(),this.connectedClients={},this.activeDataChannels={}}return i(t,[{key:"setNetworkAdapter",value:function(t){this.adapter=t}},{key:"setupDefaultDataSubscriptions",value:function(){this.dataChannelSubs={},this.dataChannelSubs[o.Update]=this.entities.updateEntity.bind(this.entities),this.dataChannelSubs[o.Remove]=this.entities.removeRemoteEntity.bind(this.entities)}},{key:"connect",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];NAF.app=e,NAF.room=n,this.adapter.setServerUrl(t),this.adapter.setApp(e),this.adapter.setRoom(n);var o={audio:i,video:!1,datachannel:!0};this.adapter.setWebRtcOptions(o),this.adapter.setServerConnectListeners(this.connectSuccess.bind(this),this.connectFailure.bind(this)),this.adapter.setDataChannelListeners(this.dataChannelOpen.bind(this),this.dataChannelClosed.bind(this),this.receivedData.bind(this)),this.adapter.setRoomOccupantListener(this.occupantsReceived.bind(this)),this.adapter.connect()}},{key:"onConnect",value:function(t){this.onConnectCallback=t,this.isConnected()?t():document.body.addEventListener("connected",t,!1)}},{key:"connectSuccess",value:function(t){NAF.log.write("Networked-Aframe Client ID:",t),NAF.clientId=t;var e=new CustomEvent("connected",{detail:{clientId:t}});document.body.dispatchEvent(e)}},{key:"connectFailure",value:function(t,e){NAF.log.error(t,"failure to connect")}},{key:"occupantsReceived",value:function(t){var e=Object.assign({},this.connectedClients);this.connectedClients=t,this.checkForDisconnectingClients(e,t),this.checkForConnectingClients(t)}},{key:"checkForDisconnectingClients",value:function(t,e){for(var n in t){var i=e.hasOwnProperty(n);i||(NAF.log.write("Closing stream to ",n),this.adapter.closeStreamConnection(n))}}},{key:"checkForConnectingClients",value:function(t){for(var e in t){var n=this.isNewClient(e)&&this.adapter.shouldStartConnectionTo(t[e]);n&&(NAF.log.write("Opening datachannel to ",e),this.adapter.startStreamConnection(e))}}},{key:"getConnectedClients",value:function(){return this.connectedClients}},{key:"isConnected",value:function(){return!!NAF.clientId}},{key:"isMineAndConnected",value:function(t){return this.isConnected()&&NAF.clientId===t}},{key:"isNewClient",value:function(t){return!this.isConnectedTo(t)}},{key:"isConnectedTo",value:function(t){return this.adapter.getConnectStatus(t)===NAF.adapters.IS_CONNECTED}},{key:"dataChannelOpen",value:function(t){NAF.log.write("Opened data channel from "+t),this.activeDataChannels[t]=!0,this.entities.completeSync(t);var e=new CustomEvent("clientConnected",{detail:{clientId:t}});document.body.dispatchEvent(e)}},{key:"dataChannelClosed",value:function(t){NAF.log.write("Closed data channel from "+t),this.activeDataChannels[t]=!1,this.entities.removeEntitiesOfClient(t);var e=new CustomEvent("clientDisconnected",{detail:{clientId:t}});document.body.dispatchEvent(e)}},{key:"hasActiveDataChannel",value:function(t){return this.activeDataChannels.hasOwnProperty(t)&&this.activeDataChannels[t]}},{key:"broadcastData",value:function(t,e){this.adapter.broadcastData(t,e)}},{key:"broadcastDataGuaranteed",value:function(t,e){this.adapter.broadcastDataGuaranteed(t,e)}},{key:"sendData",value:function(t,e,n,i){this.hasActiveDataChannel(t)&&(i?this.adapter.sendDataGuaranteed(t,e,n):this.adapter.sendData(t,e,n))}},{key:"sendDataGuaranteed",value:function(t,e,n){this.sendData(t,e,n,!0)}},{key:"subscribeToDataChannel",value:function(t,e){return this.isReservedDataType(t)?void NAF.log.error("NetworkConnection@subscribeToDataChannel: "+t+" is a reserved dataType. Choose another"):void(this.dataChannelSubs[t]=e)}},{key:"unsubscribeToDataChannel",value:function(t){return this.isReservedDataType(t)?void NAF.log.error("NetworkConnection@unsubscribeToDataChannel: "+t+" is a reserved dataType. Choose another"):void delete this.dataChannelSubs[t]}},{key:"isReservedDataType",value:function(t){return t==o.Update||t==o.Remove}},{key:"receivedData",value:function(t,e,n){this.dataChannelSubs.hasOwnProperty(e)?this.dataChannelSubs[e](t,e,n):NAF.log.error("NetworkConnection@receivedData: "+e+" has not been subscribed to yet. Call subscribeToDataChannel()")}},{key:"getServerTime",value:function(){return this.adapter.getServerTime()}},{key:"disconnect",value:function(){this.entities.removeRemoteEntities(),this.adapter.disconnect(),NAF.app="",NAF.room="",NAF.clientId="",this.connectedClients={},this.activeDataChannels={},this.adapter=null,this.setupDefaultDataSubscriptions(),document.body.removeEventListener("connected",this.onConnectCallback)}}]),t}();t.exports=r},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=n(8),a=function(){function t(){i(this,t),this.entities={},this.childCache=new r,this.onRemoteEntityCreatedEvent=new Event("remoteEntityCreated")}return o(t,[{key:"registerEntity",value:function(t,e){this.entities[t]=e}},{key:"createRemoteEntity",value:function(t){NAF.log.write("Creating remote entity",t);var e=t.networkId,n=NAF.schemas.getCachedTemplate(t.template);return n.setAttribute("id","naf-"+e),this.initPosition(n,t.components),this.initRotation(n,t.components),this.addNetworkComponent(n,t),this.registerEntity(e,n),n}},{key:"initPosition",value:function(t,e){var n=e.hasOwnProperty("position");if(n){var i=e.position;t.setAttribute("position",i)}}},{key:"initRotation",value:function(t,e){var n=e.hasOwnProperty("rotation");if(n){var i=e.rotation;t.setAttribute("rotation",i)}}},{key:"addNetworkComponent",value:function(t,e){var n={template:e.template,owner:e.owner,networkId:e.networkId};t.setAttribute("networked",n),t.firstUpdateData=e}},{key:"updateEntity",value:function(t,e,n){var i=1==n[0],o=i?n[1]:n.networkId;this.hasEntity(o)?this.entities[o].emit("networkUpdate",{entityData:n},!1):!i&&this.isFullSync(n)&&this.receiveFirstUpdateFromEntity(n)}},{key:"isFullSync",value:function(t){var e=Object.keys(t.components).length,n=NAF.schemas.getComponents(t.template).length;return e===n}},{key:"receiveFirstUpdateFromEntity",value:function(t){var e=t.parent,n=t.networkId,i=e&&!this.hasEntity(e);if(i)this.childCache.addChild(e,t);else{var o=this.createRemoteEntity(t);this.createAndAppendChildren(n,o),this.addEntityToPage(o,e)}}},{key:"createAndAppendChildren",value:function(t,e){for(var n=this.childCache.getChildren(t),i=0;i<n.length;i++){var o=n[i],r=o.networkId;if(this.hasEntity(r))NAF.log.warn("Tried to instantiate entity multiple times",r,o,"Existing entity:",this.getEntity(r));else{var a=this.createRemoteEntity(o);this.createAndAppendChildren(r,a),e.appendChild(a)}}}},{key:"addEntityToPage",value:function(t,e){this.hasEntity(e)?this.addEntityToParent(t,e):this.addEntityToSceneRoot(t)}},{key:"addEntityToParent",value:function(t,e){var n=document.getElementById("naf-"+e);n.appendChild(t)}},{key:"addEntityToSceneRoot",value:function(t){var e=document.querySelector("a-scene");e.appendChild(t)}},{key:"completeSync",value:function(t){for(var e in this.entities)this.entities.hasOwnProperty(e)&&this.entities[e].emit("syncAll",{targetClientId:t},!1)}},{key:"removeRemoteEntity",value:function(t,e,n){var i=n.networkId;return this.removeEntity(i)}},{key:"removeEntitiesOfClient",value:function(t){var e=[];for(var n in this.entities){var i=NAF.utils.getNetworkOwner(this.entities[n]);if(i==t){var o=this.removeEntity(n);e.push(o)}}return e}},{key:"removeEntity",value:function(t){if(this.hasEntity(t)){var e=this.entities[t];return delete this.entities[t],e.parentNode.removeChild(e),e}return null}},{key:"getEntity",value:function(t){return this.entities.hasOwnProperty(t)?this.entities[t]:null}},{key:"hasEntity",value:function(t){return this.entities.hasOwnProperty(t)}},{key:"removeRemoteEntities",value:function(){this.childCache=new r;for(var t in this.entities){var e=this.entities[t].getAttribute("networked").owner;e!=NAF.clientId&&this.removeEntity(t)}}}]),t}();t.exports=a},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){n(this,t),this.schemaDict={},this.templateCache={}}return i(t,[{key:"createDefaultSchema",value:function(t){return{template:t,components:["position","rotation"]}}},{key:"add",value:function(t){if(this.validateSchema(t)){this.schemaDict[t.template]=t;var e=document.querySelector(t.template);if(!e)return void NAF.log.error("Template el not found for "+t.template+", make sure NAF.schemas.add is called after <a-scene> is defined.");if(!this.validateTemplate(t,e))return;this.templateCache[t.template]=document.importNode(e.content,!0)}else NAF.log.error("Schema not valid: ",t),NAF.log.error("See https://github.com/haydenjameslee/networked-aframe#syncing-custom-components")}},{key:"getCachedTemplate",value:function(t){return this.templateIsCached(t)||(this.templateExistsInScene(t)?this.add(this.createDefaultSchema(t)):NAF.log.error("Template el for "+t+" is not in the scene, add the template to <a-assets> and register with NAF.schemas.add.")),this.templateCache[t].firstElementChild.cloneNode(!0)}},{key:"templateIsCached",value:function(t){return this.templateCache.hasOwnProperty(t)}},{key:"getComponents",value:function(t){var e=["position","rotation"];return this.hasTemplate(t)&&(e=this.schemaDict[t].components),e}},{key:"hasTemplate",value:function(t){return this.schemaDict.hasOwnProperty(t)}},{key:"templateExistsInScene",value:function(t){var e=document.querySelector(t);return e&&this.isTemplateTag(e)}},{key:"validateSchema",value:function(t){return t.hasOwnProperty("template")&&t.hasOwnProperty("components")}},{key:"validateTemplate",value:function(t,e){return this.isTemplateTag(e)?!!this.templateHasOneOrZeroChildren(e)||(NAF.log.error("Template for "+t.template+" has more than one child. Templates must have one direct child element, no more. Template found:",e),!1):(NAF.log.error("Template for "+t.template+" is not a <template> tag. Instead found: "+e.tagName),!1)}},{key:"isTemplateTag",value:function(t){return"template"===t.tagName.toLowerCase()}},{key:"templateHasOneOrZeroChildren",value:function(t){return t.content.childElementCount<2}},{key:"remove",value:function(t){delete this.schemaDict[t]}},{key:"clear",value:function(){this.schemaDict={}}}]),t}();t.exports=o},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=n(18),a=n(17),s=function(){function t(){i(this,t),this.adapters={wseasyrtc:r,easyrtc:a},this.IS_CONNECTED=t.IS_CONNECTED,this.CONNECTING=t.CONNECTING,this.NOT_CONNECTED=t.NOT_CONNECTED}return o(t,[{key:"register",value:function(t,e){this.adapters[t]=e}},{key:"make",value:function(t){var e=t.toLowerCase();if(this.adapters[e]){var n=this.adapters[e];return new n}throw new Error("Adapter: "+t+" not registered. Please use NAF.adapters.register() to register this adapter.")}}]),t}();s.IS_CONNECTED="IS_CONNECTED",s.CONNECTING="CONNECTING",s.NOT_CONNECTED="NOT_CONNECTED",t.exports=s},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(2),u=function(t){function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.easyrtc=t||window.easyrtc,n.app="default",n.room="default",n.audioStreams={},n.pendingAudioRequest={},n.serverTimeRequests=0,n.timeOffsets=[],n.avgTimeOffset=0,n}return r(e,t),s(e,[{key:"setServerUrl",value:function(t){this.easyrtc.setSocketUrl(t)}},{key:"setApp",value:function(t){this.app=t}},{key:"setRoom",value:function(t){this.room=t,this.easyrtc.joinRoom(t,null)}},{key:"setWebRtcOptions",value:function(t){this.easyrtc.enableDataChannels(t.datachannel),this.easyrtc.enableVideo(!1),this.easyrtc.enableAudio(t.audio),this.easyrtc.enableVideoReceive(!1),this.easyrtc.enableAudioReceive(t.audio)}},{key:"setServerConnectListeners",value:function(t,e){this.connectSuccess=t,this.connectFailure=e}},{key:"setRoomOccupantListener",value:function(t){this.easyrtc.setRoomOccupantListener(function(e,n,i){t(n)})}},{key:"setDataChannelListeners",value:function(t,e,n){this.easyrtc.setDataChannelOpenListener(t),this.easyrtc.setDataChannelCloseListener(e),this.easyrtc.setPeerListener(n)}},{key:"updateTimeOffset",value:function(){var t=this,e=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:"HEAD",cache:"no-cache"}).then(function(n){var i=1e3,o=new Date(n.headers.get("Date")).getTime()+i/2,r=Date.now(),a=o+(r-e)/2,s=a-r;t.serverTimeRequests++,t.serverTimeRequests<=10?t.timeOffsets.push(s):t.timeOffsets[t.serverTimeRequests%10]=s,t.avgTimeOffset=t.timeOffsets.reduce(function(t,e){return t+=e},0)/t.timeOffsets.length,t.serverTimeRequests>10?setTimeout(function(){return t.updateTimeOffset()},3e5):t.updateTimeOffset()})}},{key:"connect",value:function(){var t=this;Promise.all([this.updateTimeOffset(),new Promise(function(e,n){t.easyrtc.audioEnabled?t._connectWithAudio(e,n):t.easyrtc.connect(t.app,e,n)})]).then(function(e){var n=a(e,2),i=(n[0],n[1]);t._storeAudioStream(t.easyrtc.myEasyrtcid,t.easyrtc.getLocalStream()),t._myRoomJoinTime=t._getRoomJoinTime(i),t.connectSuccess(i)}).catch(this.connectFailure)}},{key:"shouldStartConnectionTo",value:function(t){return this._myRoomJoinTime<=t.roomJoinTime}},{key:"startStreamConnection",value:function(t){this.easyrtc.call(t,function(t,e){"datachannel"===e&&NAF.log.write("Successfully started datachannel to ",t)},function(t,e){NAF.log.error(t,e)},function(t){})}},{key:"closeStreamConnection",value:function(t){}},{key:"sendData",value:function(t,e,n){this.easyrtc.sendData(t,e,n)}},{key:"sendDataGuaranteed",value:function(t,e,n){this.easyrtc.sendDataWS(t,e,n)}},{key:"broadcastData",value:function(t,e){var n=this.easyrtc.getRoomOccupantsAsMap(this.room);for(var i in n)n.hasOwnProperty(i)&&i!==this.easyrtc.myEasyrtcid&&this.easyrtc.sendData(i,t,e)}},{key:"broadcastDataGuaranteed",value:function(t,e){var n={targetRoom:this.room};this.easyrtc.sendDataWS(n,t,e)}},{key:"getConnectStatus",value:function(t){var e=this.easyrtc.getConnectStatus(t);return e==this.easyrtc.IS_CONNECTED?NAF.adapters.IS_CONNECTED:e==this.easyrtc.NOT_CONNECTED?NAF.adapters.NOT_CONNECTED:NAF.adapters.CONNECTING}},{key:"getMediaStream",value:function(t){var e=this;return this.audioStreams[t]?(NAF.log.write("Already had audio for "+t),Promise.resolve(this.audioStreams[t])):(NAF.log.write("Waiting on audio for "+t),new Promise(function(n){e.pendingAudioRequest[t]=n}))}},{key:"disconnect",value:function(){this.easyrtc.disconnect()}},{key:"_storeAudioStream",value:function(t,e){this.audioStreams[t]=e,this.pendingAudioRequest[t]&&(NAF.log.write("got pending audio for "+t),this.pendingAudioRequest[t](e),delete this.pendingAudioRequest[t](e))}},{key:"_connectWithAudio",value:function(t,e){var n=this;this.easyrtc.setStreamAcceptor(this._storeAudioStream.bind(this)),this.easyrtc.setOnStreamClosed(function(t){delete n.audioStreams[t]}),this.easyrtc.initMediaSource(function(){n.easyrtc.connect(n.app,t,e)},function(t,e){NAF.log.error(t,e)})}},{key:"_getRoomJoinTime",value:function(t){var e=NAF.room,n=this.easyrtc.getRoomOccupantsAsMap(e)[t].roomJoinTime;return n}},{key:"getServerTime",value:function(){return Date.now()+this.avgTimeOffset}}]),e}(c);t.exports=u},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(2),u=function(t){function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.easyrtc=t||window.easyrtc,n.app="default",n.room="default",n.connectedClients=[],n.serverTimeRequests=0,n.timeOffsets=[],n.avgTimeOffset=0,n}return r(e,t),s(e,[{key:"setServerUrl",value:function(t){this.serverUrl=t,this.easyrtc.setSocketUrl(t)}},{key:"setApp",value:function(t){this.app=t}},{key:"setRoom",value:function(t){this.room=t,this.easyrtc.joinRoom(t,null)}},{key:"setWebRtcOptions",value:function(t){}},{key:"setServerConnectListeners",value:function(t,e){this.connectSuccess=t,this.connectFailure=e}},{key:"setRoomOccupantListener",value:function(t){this.easyrtc.setRoomOccupantListener(function(e,n,i){t(n)})}},{key:"setDataChannelListeners",value:function(t,e,n){this.openListener=t,this.closedListener=e,this.easyrtc.setPeerListener(n)}},{key:"updateTimeOffset",value:function(){var t=this,e=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:"HEAD",cache:"no-cache"}).then(function(n){var i=1e3,o=new Date(n.headers.get("Date")).getTime()+i/2,r=Date.now(),a=o+(r-e)/2,s=a-r;t.serverTimeRequests++,t.serverTimeRequests<=10?t.timeOffsets.push(s):t.timeOffsets[t.serverTimeRequests%10]=s,
t.avgTimeOffset=t.timeOffsets.reduce(function(t,e){return t+=e},0)/t.timeOffsets.length,t.serverTimeRequests>10?setTimeout(function(){return t.updateTimeOffset()},3e5):t.updateTimeOffset()})}},{key:"connect",value:function(){var t=this;Promise.all([this.updateTimeOffset(),new Promise(function(e,n){t.easyrtc.connect(t.app,e,n)})]).then(function(e){var n=a(e,2),i=(n[0],n[1]);t.connectSuccess(i)}).catch(this.connectFailure)}},{key:"shouldStartConnectionTo",value:function(t){return!0}},{key:"startStreamConnection",value:function(t){this.connectedClients.push(t),this.openListener(t)}},{key:"closeStreamConnection",value:function(t){var e=this.connectedClients.indexOf(t);e>-1&&this.connectedClients.splice(e,1),this.closedListener(t)}},{key:"sendData",value:function(t,e,n){this.easyrtc.sendDataWS(t,e,n)}},{key:"sendDataGuaranteed",value:function(t,e,n){this.sendData(t,e,n)}},{key:"broadcastData",value:function(t,e){var n={targetRoom:this.room};this.easyrtc.sendDataWS(n,t,e)}},{key:"broadcastDataGuaranteed",value:function(t,e){this.broadcastData(t,e)}},{key:"getConnectStatus",value:function(t){var e=this.connectedClients.indexOf(t)!=-1;return e?NAF.adapters.IS_CONNECTED:NAF.adapters.NOT_CONNECTED}},{key:"getServerTime",value:function(){return Date.now()+this.avgTimeOffset}},{key:"disconnect",value:function(){this.easyrtc.disconnect()}}]),e}(c);t.exports=u},function(t,e,n){"use strict";var i=n(1);AFRAME.registerComponent("networked-audio-source",{schema:{positional:{default:!0},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},maxDistance:{default:1e4},refDistance:{default:1},rolloffFactor:{default:1}},init:function(){var t=this;this.listener=null,this.stream=null,this._setMediaStream=this._setMediaStream.bind(this),NAF.utils.getNetworkedEntity(this.el).then(function(e){var n=e.components.networked.data.owner;n&&NAF.connection.adapter.getMediaStream(n).then(t._setMediaStream).catch(function(t){return i.log.error("Error getting media stream for "+n,t)})})},update:function(){this._setPannerProperties()},_setMediaStream:function(t){this.sound||this.setupSound(),t!=this.stream&&(this.stream&&this.sound.disconnect(),t&&(this.audioEl=new Audio,this.audioEl.setAttribute("autoplay","autoplay"),this.audioEl.setAttribute("playsinline","playsinline"),this.audioEl.srcObject=t,this.audioEl.volume=0,this.sound.setNodeSource(this.sound.context.createMediaStreamSource(t))),this.stream=t)},_setPannerProperties:function(){this.sound&&this.data.positional&&(this.sound.setDistanceModel(this.data.distanceModel),this.sound.setMaxDistance(this.data.maxDistance),this.sound.setRefDistance(this.data.refDistance),this.sound.setRolloffFactor(this.data.rolloffFactor))},remove:function(){this.sound&&(this.el.removeObject3D(this.attrName),this.stream&&this.sound.disconnect())},setupSound:function(){var t=this.el,e=t.sceneEl;this.sound&&t.removeObject3D(this.attrName),e.audioListener||(e.audioListener=new THREE.AudioListener,e.camera&&e.camera.add(e.audioListener),e.addEventListener("camera-set-active",function(t){t.detail.cameraEl.getObject3D("camera").add(e.audioListener)})),this.listener=e.audioListener,this.sound=this.data.positional?new THREE.PositionalAudio(this.listener):new THREE.Audio(this.listener),t.setObject3D(this.attrName,this.sound),this._setPannerProperties()}})},function(t,e){"use strict";AFRAME.registerComponent("networked-scene",{schema:{serverURL:{default:"/"},app:{default:"default"},room:{default:"default"},connectOnLoad:{default:!0},onConnect:{default:"onConnect"},adapter:{default:"wsEasyRtc"},audio:{default:!1},debug:{default:!1}},init:function(){var t=this.el;this.connect=this.connect.bind(this),t.addEventListener("connect",this.connect),this.data.connectOnLoad&&t.emit("connect",null,!1)},connect:function(){NAF.log.setDebug(this.data.debug),NAF.log.write("Networked-Aframe Connecting..."),this.checkDeprecatedProperties(),this.setupNetworkAdapter(),this.hasOnConnectFunction()&&this.callOnConnect(),NAF.connection.connect(this.data.serverURL,this.data.app,this.data.room,this.data.audio)},checkDeprecatedProperties:function(){},setupNetworkAdapter:function(){var t=this.data.adapter,e=NAF.adapters.make(t);NAF.connection.setNetworkAdapter(e)},hasOnConnectFunction:function(){return""!=this.data.onConnect&&window.hasOwnProperty(this.data.onConnect)},callOnConnect:function(){NAF.connection.onConnect(window[this.data.onConnect])},remove:function(){NAF.log.write("networked-scene disconnected"),this.el.removeEventListener("connect",this.connect),NAF.connection.disconnect()}})},function(t,e,n){"use strict";var i=n(9),o=n(10),r=AFRAME.utils.bind;AFRAME.registerComponent("networked",{schema:{template:{default:""},attachTemplateToLocal:{default:!0},networkId:{default:""},owner:{default:""}},init:function(){this.OWNERSHIP_GAINED="ownership-gained",this.OWNERSHIP_CHANGED="ownership-changed",this.OWNERSHIP_LOST="ownership-lost";var t=this.wasCreatedByNetwork();this.onConnected=r(this.onConnected,this),this.onSyncAll=r(this.onSyncAll,this),this.syncDirty=r(this.syncDirty,this),this.networkUpdateHandler=r(this.networkUpdateHandler,this),this.cachedData={},this.initNetworkParent(),""===this.data.networkId&&this.el.setAttribute(this.name,{networkId:NAF.utils.createNetworkId()}),t?(this.firstUpdate(),this.attachLerp()):(this.data.attachTemplateToLocal&&this.attachTemplateToLocal(),this.registerEntity(this.data.networkId)),this.lastOwnerTime=-1,NAF.clientId?this.onConnected():document.body.addEventListener("connected",this.onConnected,!1),document.body.dispatchEvent(this.entityCreatedEvent()),this.el.dispatchEvent(new CustomEvent("instantiated",{detail:{el:this.el}}))},attachTemplateToLocal:function(){for(var t=NAF.schemas.getCachedTemplate(this.data.template),e=t.attributes,n=0;n<e.length;n++)this.el.setAttribute(e[n].name,e[n].value);for(;t.firstElementChild;)this.el.appendChild(t.firstElementChild)},takeOwnership:function(){var t=this.data.owner,e=this.lastOwnerTime,n=NAF.connection.getServerTime();return!!(t&&!this.isMine()&&e<n)&&(this.lastOwnerTime=n,this.removeLerp(),this.el.setAttribute("networked",{owner:NAF.clientId}),this.syncAll(),this.el.emit(this.OWNERSHIP_GAINED,{el:this.el,oldOwner:t}),this.el.emit(this.OWNERSHIP_CHANGED,{el:this.el,oldOwner:t,newOwner:NAF.clientId}),!0)},wasCreatedByNetwork:function(){return!!this.el.firstUpdateData},initNetworkParent:function(){var t=this.el.parentElement;t.hasOwnProperty("components")&&t.components.hasOwnProperty("networked")?this.parent=t:this.parent=null},attachLerp:function(){NAF.options.useLerp&&this.el.setAttribute("lerp","")},removeLerp:function(){NAF.options.useLerp&&this.el.removeAttribute("lerp")},registerEntity:function(t){NAF.entities.registerEntity(t,this.el)},firstUpdate:function(){var t=this.el.firstUpdateData;this.networkUpdate(t)},onConnected:function(){var t=this;""===this.data.owner&&(this.lastOwnerTime=NAF.connection.getServerTime(),this.el.setAttribute(this.name,{owner:NAF.clientId}),setTimeout(function(){t.syncAll()},0)),document.body.removeEventListener("connected",this.onConnected,!1)},isMine:function(){return this.data.owner===NAF.clientId},play:function(){this.bindEvents()},bindEvents:function(){var t=this.el;t.addEventListener("sync",this.syncDirty),t.addEventListener("syncAll",this.onSyncAll),t.addEventListener("networkUpdate",this.networkUpdateHandler)},pause:function(){this.unbindEvents()},unbindEvents:function(){var t=this.el;t.removeEventListener("sync",this.syncDirty),t.removeEventListener("syncAll",this.onSyncAll),t.removeEventListener("networkUpdate",this.networkUpdateHandler)},tick:function(){this.isMine()&&this.needsToSync()&&this.syncDirty()},onSyncAll:function(t){var e=t.detail.targetClientId;this.syncAll(e)},syncAll:function(t){if(this.canSync()){this.updateNextSyncTime();var e=this.getAllSyncedComponents(),n=i.gatherComponentsData(this.el,e),o=this.createSyncData(n);t?NAF.connection.sendDataGuaranteed(t,"u",o):NAF.connection.broadcastDataGuaranteed("u",o),this.updateCache(n)}},syncDirty:function(){if(this.canSync()){this.updateNextSyncTime();var t=this.getAllSyncedComponents(),e=i.findDirtyComponents(this.el,t,this.cachedData);if(0!=e.length){var n=i.gatherComponentsData(this.el,e),r=this.createSyncData(n);NAF.options.compressSyncPackets&&(r=o.compressSyncData(r,t)),NAF.connection.broadcastData("u",r),this.updateCache(n)}}},canSync:function(){return this.data.owner&&this.isMine()},needsToSync:function(){return NAF.utils.now()>=this.nextSyncTime},updateNextSyncTime:function(){this.nextSyncTime=NAF.utils.now()+1e3/NAF.options.updateRate},createSyncData:function(t){var e=this.data,n={0:0,networkId:e.networkId,owner:e.owner,lastOwnerTime:this.lastOwnerTime,template:e.template,parent:this.getParentId(),components:t};return n},getParentId:function(){if(this.initNetworkParent(),!this.parent)return null;var t=this.parent.getAttribute("networked");return t.networkId},getAllSyncedComponents:function(){return NAF.schemas.getComponents(this.data.template)},updateCache:function(t){for(var e in t)this.cachedData[e]=t[e]},networkUpdateHandler:function(t){var e=t.detail.entityData;this.networkUpdate(e)},networkUpdate:function(t){if(1==t[0]&&(t=o.decompressSyncData(t,this.getAllSyncedComponents())),!(t.lastOwnerTime<this.lastOwnerTime||this.lastOwnerTime===t.lastOwnerTime&&this.data.owner>t.owner)){if(this.data.owner!==t.owner){var e=this.isMine();this.lastOwnerTime=t.lastOwnerTime,this.attachLerp();var n=this.data.owner,i=t.owner;e&&this.el.emit(this.OWNERSHIP_LOST,{el:this.el,newOwner:i}),this.el.emit(this.OWNERSHIP_CHANGED,{el:this.el,oldOwner:n,newOwner:i}),this.el.setAttribute("networked",{owner:t.owner})}this.updateComponents(t.components)}},updateComponents:function(t){var e=this.el;for(var n in t)if(this.isSyncableComponent(n)){var i=t[n];if(NAF.utils.isChildSchemaKey(n)){var o=NAF.utils.keyToChildSchema(n),r=o.selector?e.querySelector(o.selector):e;r&&(o.property?r.setAttribute(o.component,o.property,i):r.setAttribute(o.component,i))}else e.setAttribute(n,i)}},isSyncableComponent:function(t){if(NAF.utils.isChildSchemaKey(t)){var e=NAF.utils.keyToChildSchema(t);return this.hasThisChildSchema(e)}return this.getAllSyncedComponents().indexOf(t)!=-1},hasThisChildSchema:function(t){var e=this.getAllSyncedComponents();for(var n in e){var i=e[n];if(NAF.utils.childSchemaEqual(i,t))return!0}return!1},remove:function(){if(this.isMine()&&NAF.connection.isConnected()){var t={networkId:this.data.networkId};NAF.connection.broadcastDataGuaranteed("r",t)}document.body.dispatchEvent(this.entityRemovedEvent(this.data.networkId))},entityCreatedEvent:function(){return new CustomEvent("entityCreated",{detail:{el:this.el}})},entityRemovedEvent:function(t){return new CustomEvent("entityRemoved",{detail:{networkId:t}})}})},function(t,e){"use strict";var n={debug:!1,updateRate:15,compressSyncPackets:!1,useLerp:!0};t.exports=n},function(t,e){"use strict";function n(t){return new Promise(function(e,n){for(var i=t;i&&!i.hasAttribute("networked");)i=i.parentNode;return i?void(i.hasLoaded?e(i):i.addEventListener("instantiated",function(){e(i)},{once:!0})):n("Entity does not have and is not a child of an entity with the [networked] component ")})}t.exports.whenEntityLoaded=function(t,e){t.hasLoaded&&e(),t.addEventListener("loaded",function(){e()})},t.exports.createHtmlNodeFromString=function(t){var e=document.createElement("div");e.innerHTML=t;var n=e.firstChild;return n},t.exports.getNetworkOwner=function(t){var e=t.components;return e.hasOwnProperty("networked")?e.networked.data.owner:null},t.exports.getNetworkId=function(t){var e=t.components;return e.hasOwnProperty("networked")?e.networked.networkId:null},t.exports.now=function(){return Date.now()},t.exports.createNetworkId=function(){return Math.random().toString(36).substring(2,9)},t.exports.delimiter="---",t.exports.childSchemaToKey=function(e){var n=(e.selector||"")+t.exports.delimiter+(e.component||"")+t.exports.delimiter+(e.property||"");return n},t.exports.keyToChildSchema=function(e){var n=e.split(t.exports.delimiter,3);return{selector:n[0]||void 0,component:n[1],property:n[2]||void 0}},t.exports.isChildSchemaKey=function(e){return e.indexOf(t.exports.delimiter)!=-1},t.exports.childSchemaEqual=function(t,e){return t.selector==e.selector&&t.component==e.component&&t.property==e.property},t.exports.getNetworkedEntity=n,t.exports.takeOwnership=function(t){for(var e=t;e&&!e.hasAttribute("networked");)e=e.parentNode;if(e){if(!e.components.networked)throw new Error("Entity with [networked] component not initialized.");return e.components.networked.takeOwnership()}throw new Error("takeOwnership() must be called on an entity or child of an entity with the [networked] component.")},t.exports.isMine=function(t){for(var e=t;e&&!e.hasAttribute("networked");)e=e.parentNode;if(e){if(!e.components.networked)throw new Error("Entity with [networked] component not initialized.");return e.components.networked.data.owner===NAF.clientId}throw new Error("isMine() must be called on an entity or child of an entity with the [networked] component.")}}]);